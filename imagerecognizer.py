# from distutils.command.config import config
# from pyexpat import model
import cv2
import matplotlib.pyplot as plt 
import urllib.request as ureq
import numpy as np

config_file = 'ssd_mobilenet_v3_large_coco_2020_01_14.pbtxt'
frozen_model = 'frozen_inference_graph.pb'

model = cv2.dnn_DetectionModel(frozen_model,config_file)

model.setInputSize(320,320)
model.setInputScale(1.0/127.5)
model.setInputMean((127.5,127.5,127.5))
model.setInputSwapRB(True)

classLabels = []
file_names = 'labels.txt'
with open(file_names,'rt') as fpt:
    classLabels = fpt.read().rstrip('\n').split('\n')

url = "data:image/jpeg;base64,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"
url_response = ureq.urlopen(url)
img_array = np.array(bytearray(url_response.read()), dtype=np.uint8)
img = cv2.imdecode(img_array, -1)
# img = cv2.imread('laptop.jpg')

ClassIndex, confidence,bbox = model.detect(img,confThreshold=0.5)
print(ClassIndex)

font_scale = 1
font = cv2.FONT_HERSHEY_DUPLEX
for ClassInd,conf,boxes in zip(ClassIndex.flatten(), confidence.flatten(), bbox):
    cv2.rectangle(img,boxes,(255,0,0),2)
    cv2.putText(img,classLabels[ClassInd-1],(boxes[0]+10,boxes[1]+40),font,fontScale=font_scale,color=(0,255,0),thickness=2)

plt.imshow(cv2.cvtColor(img,cv2.COLOR_BGR2RGB))
plt.show()
print(plt.imshow(cv2.cvtColor(img,cv2.COLOR_BGR2RGB)))